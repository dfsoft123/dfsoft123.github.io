<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能字数统计工具 - 多种输出模式</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --warning: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --border: #dee2e6;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 25px var(--shadow);
        }

        header h1 {
            color: var(--primary);
            font-size: 2.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        header h1 i {
            color: var(--secondary);
        }

        header p {
            color: var(--gray);
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 25px var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
        }

        .card h2 i {
            color: var(--secondary);
        }

        .input-area {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        textarea {
            width: 100%;
            height: 400px;
            padding: 20px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s, box-shadow 0.3s;
            margin-bottom: 20px;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            min-width: 160px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #3bb5d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.4);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #e01a72;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(247, 37, 133, 0.4);
        }

        .btn-info {
            background: #7209b7;
            color: white;
        }

        .btn-info:hover {
            background: #60099a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(114, 9, 183, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: var(--light);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            border-left: 5px solid var(--primary);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .stat-card i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .stat-title {
            font-size: 1.1rem;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .stat-unit {
            font-size: 1rem;
            color: var(--gray);
        }

        .output-section, .history-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .output-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }

        .output-area {
            width: 100%;
            height: 200px;
            padding: 20px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            line-height: 1.6;
            resize: vertical;
            background: #f8f9fa;
            margin-bottom: 20px;
            white-space: pre-wrap;
            overflow-y: auto;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .output-header h3 {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .copy-btn {
            padding: 10px 20px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .copy-btn:hover {
            background: #3bb5d8;
        }

        .file-upload {
            margin-top: 25px;
            padding: 25px;
            border: 2px dashed var(--border);
            border-radius: 12px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        .file-upload.dragover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .file-upload p {
            margin-bottom: 15px;
            color: var(--gray);
            font-size: 1.1rem;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .file-label:hover {
            background: var(--primary-dark);
        }

        .file-info {
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            color: var(--primary);
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .summary {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: 16px;
            margin-top: 30px;
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.3);
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .settings {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .settings label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .settings input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .history-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: #f8f9fa;
        }

        .history-item {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }

        .history-item:hover {
            background: #e9ecef;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-date {
            font-weight: 600;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .history-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .history-stat {
            background: white;
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            font-size: 0.9rem;
        }

        .history-stat strong {
            color: var(--primary);
        }

        .history-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .load-btn {
            background: var(--success);
            color: white;
        }

        .load-btn:hover {
            background: #3bb5d8;
        }

        .delete-btn {
            background: var(--warning);
            color: white;
        }

        .delete-btn:hover {
            background: #e01a72;
        }

        .view-btn {
            background: var(--primary);
            color: white;
        }

        .view-btn:hover {
            background: var(--primary-dark);
        }

        .history-preview {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border);
            max-height: 150px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .empty-history {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }

        .empty-history i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--border);
        }

        .history-details {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .history-details.hidden {
            display: none;
        }

        .history-details h4 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-details {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--gray);
            cursor: pointer;
        }

        .history-text {
            white-space: pre-wrap;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .highlight {
            background-color: rgba(247, 37, 133, 0.1);
            padding: 2px 5px;
            border-radius: 4px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: 600;
            animation: slideIn 0.3s ease;
        }

        .notification.info {
            background: var(--primary);
            color: white;
        }

        .notification.success {
            background: var(--success);
            color: white;
        }

        .notification.warning {
            background: var(--warning);
            color: white;
        }

        .notification.error {
            background: #dc3545;
            color: white;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        @media (max-width: 768px) {
            .main-content {
                gap: 20px;
            }
            
            .card {
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .summary {
                flex-direction: column;
                gap: 20px;
            }
            
            header h1 {
                font-size: 2.2rem;
            }
            
            .history-controls {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .history-stats {
                flex-direction: column;
            }
            
            .output-tabs {
                flex-direction: column;
            }
            
            .tab {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-code"></i> 智能字数统计工具</h1>
            <p>精确统计各类字符数量，支持三种输出模式、实时统计、文件上传和历史记录功能</p>
        </header>

        <div class="main-content">
            <div class="card input-area">
                <h2><i class="fas fa-edit"></i> 输入文本</h2>
                <textarea id="textInput" placeholder="请在此输入或粘贴要统计的文本...">欢迎使用智能字数统计工具！

这是一个演示文本，包含：
1. 中文字符：你好，世界！
2. 数字：12345
3. 外文字符：Hello World
4. 标点符号：，。！？,.!?
5. 其他符号：@#$%&*
6. 空格：   这里有很多空格    

你可以尝试输入自己的文本，或上传文件进行统计。</textarea>
                
                <div class="buttons">
                    <button class="btn btn-primary" onclick="countCharacters()">
                        <i class="fas fa-calculator"></i> 开始统计
                    </button>
                    <button class="btn btn-success" onclick="generateAllOutputs()">
                        <i class="fas fa-file-export"></i> 生成所有输出
                    </button>
                    <button class="btn btn-info" onclick="saveToHistory()">
                        <i class="fas fa-save"></i> 保存记录
                    </button>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-secondary" onclick="clearText()">
                        <i class="fas fa-trash-alt"></i> 清空文本
                    </button>
                    <button class="btn btn-secondary" onclick="pasteText()">
                        <i class="fas fa-paste"></i> 粘贴文本
                    </button>
                    <button class="btn btn-warning" onclick="clearHistory()">
                        <i class="fas fa-trash"></i> 清空历史
                    </button>
                </div>
                
                <div class="settings">
                    <label>
                        <input type="checkbox" id="autoSave" checked>
                        <i class="fas fa-sync-alt"></i> 自动保存统计记录
                    </label>
                    <label>
                        <input type="checkbox" id="autoGenerate" checked>
                        <i class="fas fa-bolt"></i> 输入时自动统计
                    </label>
                </div>
                
                <div class="file-upload" id="dropArea">
                    <p><i class="fas fa-cloud-upload-alt"></i> 拖放文件到这里，或点击选择文件</p>
                    <input type="file" id="fileInput" class="file-input" accept=".txt,.md,.html,.js,.css,.py,.java,.cpp,.csv,.json,.xml">
                    <label for="fileInput" class="file-label">
                        <i class="fas fa-folder-open"></i> 选择文件
                    </label>
                    <div class="file-info" id="fileInfo"></div>
                </div>
                
                <div class="loading" id="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>正在处理文件...</p>
                </div>
            </div>

            <div class="card stats-area">
                <h2><i class="fas fa-chart-bar"></i> 统计结果</h2>
                <div class="stats-grid" id="statsGrid">
                    <!-- 统计结果将通过JavaScript动态生成 -->
                </div>
            </div>

            <div class="card output-section">
                <h2><i class="fas fa-file-export"></i> 输出模式</h2>
                
                <div class="output-tabs" id="outputTabs">
                    <button class="tab active" onclick="switchOutputTab(1)">
                        <i class="fas fa-minus"></i> 只去除空格
                    </button>
                    <button class="tab" onclick="switchOutputTab(2)">
                        <i class="fas fa-compress-alt"></i> 只去除换行
                    </button>
                    <button class="tab" onclick="switchOutputTab(3)">
                        <i class="fas fa-ban"></i> 去除空格和换行
                    </button>
                </div>
                
                <div class="output-header">
                    <h3 id="outputTitle">输出文本（只去除空格）</h3>
                    <button class="copy-btn" onclick="copyOutput()">
                        <i class="fas fa-copy"></i> 复制到剪贴板
                    </button>
                </div>
                
                <div class="output-area" id="outputArea">
                    <!-- 输出文本将在这里显示 -->
                </div>
                
                <p><span class="highlight">提示：</span> 
                    <strong>只去除空格</strong>：保留换行，只去除空格和制表符<br>
                    <strong>只去除换行</strong>：保留空格，将多行合并为一行<br>
                    <strong>去除空格和换行</strong>：去除所有空白字符，合并为一行
                </p>
            </div>

            <div class="card history-section">
                <h2><i class="fas fa-history"></i> 历史记录</h2>
                <div class="history-controls">
                    <div>
                        <button class="btn btn-secondary" onclick="toggleHistoryDetails()">
                            <i class="fas fa-eye"></i> 显示/隐藏详细记录
                        </button>
                    </div>
                    <div>
                        <span id="historyCount">0</span> 条记录
                    </div>
                </div>
                
                <div class="history-details hidden" id="historyDetails">
                    <!-- 详细历史记录将通过JavaScript动态生成 -->
                </div>
                
                <div class="history-list" id="historyList">
                    <!-- 历史记录将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>

        <div class="summary" id="summarySection">
            <!-- 摘要信息将通过JavaScript动态生成 -->
        </div>

        <footer>
            <p>© 2023 智能字数统计工具 | 支持三种输出模式：只去除空格、只去除换行、去除空格和换行</p>
            <p>本工具完全在浏览器中运行，数据保存在本地，不会上传您的文本数据，请放心使用。</p>
        </footer>
    </div>

    <script>
        // 全局变量
        let currentStats = {};
        let history = [];
        const HISTORY_KEY = 'characterCounterHistoryV3';
        const CURRENT_TEXT_KEY = 'characterCounterCurrentTextV3'; // 保存当前文本的键
        const MAX_HISTORY_ITEMS = 20;
        let currentOutputTab = 1; // 1:只去除空格, 2:只去除换行, 3:去除空格和换行
        let currentOutputText = "";

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 从localStorage恢复当前文本
            const savedText = localStorage.getItem(CURRENT_TEXT_KEY);
            if (savedText) {
                document.getElementById('textInput').value = savedText;
            }
            countCharacters();
            setupFileUpload();
            setupDragAndDrop();
            loadHistory();
            generateAllOutputs();
            
            // 设置自动统计
            const autoGenerateCheckbox = document.getElementById('autoGenerate');
            const textInput = document.getElementById('textInput');
            
            function setupAutoGenerate() {
                if (autoGenerateCheckbox.checked) {
                    textInput.addEventListener('input', countCharacters);
                } else {
                    textInput.removeEventListener('input', countCharacters);
                }
            }
            
            autoGenerateCheckbox.addEventListener('change', setupAutoGenerate);
            setupAutoGenerate(); // 初始设置
            
            // 设置自动保存提示
            const autoSaveCheckbox = document.getElementById('autoSave');
            autoSaveCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    showNotification('已开启自动保存记录功能！', 'success');
                } else {
                    showNotification('已关闭自动保存记录功能！', 'info');
                }
            });
        });

        // 字符统计函数
        function countCharacters() {
            const text = document.getElementById('textInput').value;
            const stats = analyzeText(text);
            currentStats = stats;
            
            displayStats(stats);
            updateSummary(stats);
            
            // 自动保存当前文本到localStorage
            localStorage.setItem(CURRENT_TEXT_KEY, text);
            
            // 自动保存记录
            if (document.getElementById('autoSave').checked && text.trim().length > 0) {
                // 延迟保存，避免频繁保存
                clearTimeout(window.autoSaveTimeout);
                window.autoSaveTimeout = setTimeout(() => {
                    saveToHistory();
                }, 1000); // 1秒延迟
            }
            
            // 自动生成输出
            generateAllOutputs();
        }

        // 文本分析函数
        function analyzeText(text) {
            // 初始化统计对象
            const stats = {
                chineseChars: 0,     // 中文字符
                digits: 0,           // 数字
                foreignChars: 0,     // 外文字符（英文字母）
                punctuation: 0,      // 标点符号
                symbols: 0,          // 其他符号
                spaces: 0,           // 空格
                newlines: 0,         // 换行符
                totalWithSpaces: 0,  // 总字符数（含空格）
                totalWithoutSpaces: 0 // 总字符数（不含空格）
            };

            // 定义字符分类的正则表达式
            const chineseRegex = /[\u4e00-\u9fff]/g;  // 中文字符
            const digitRegex = /[0-9]/g;              // 数字
            const foreignRegex = /[a-zA-Z]/g;         // 英文字母
            const spaceRegex = /[ \t]/g;              // 空格和制表符（不包含换行符）
            const newlineRegex = /\n/g;               // 换行符
            const punctuationRegex = /[，。！？；："'、,.!?;:"']/g; // 中英文标点
            
            // 计算各类字符数量
            stats.chineseChars = (text.match(chineseRegex) || []).length;
            stats.digits = (text.match(digitRegex) || []).length;
            stats.foreignChars = (text.match(foreignRegex) || []).length;
            stats.spaces = (text.match(spaceRegex) || []).length;
            stats.newlines = (text.match(newlineRegex) || []).length;
            stats.punctuation = (text.match(punctuationRegex) || []).length;
            
            // 计算总字符数（含空格）
            stats.totalWithSpaces = text.length;
            
            // 计算总字符数（不含空格）
            stats.totalWithoutSpaces = text.replace(/\s/g, '').length;
            
            // 计算其他符号（排除上述所有类别和空格、换行符）
            // 先计算已知类别的字符总数
            const knownChars = stats.chineseChars + stats.digits + stats.foreignChars + 
                              stats.punctuation + stats.spaces + stats.newlines;
            
            // 将文本中的换行符也排除
            const textWithoutNewlines = text.replace(/\n/g, '');
            
            // 其他符号 = 总字符数（不含换行符） - 已知字符数
            stats.symbols = textWithoutNewlines.length - knownChars;
            
            // 确保符号数不为负数
            stats.symbols = Math.max(0, stats.symbols);
            
            return stats;
        }

        // 显示统计结果
        function displayStats(stats) {
            const statsGrid = document.getElementById('statsGrid');
            
            const statsData = [
                { 
                    icon: 'fas fa-language', 
                    title: '中文字符', 
                    value: stats.chineseChars, 
                    unit: '个',
                    color: '#4361ee'
                },
                { 
                    icon: 'fas fa-hashtag', 
                    title: '数字', 
                    value: stats.digits, 
                    unit: '个',
                    color: '#7209b7'
                },
                { 
                    icon: 'fas fa-font', 
                    title: '外文字符', 
                    value: stats.foreignChars, 
                    unit: '个',
                    color: '#4cc9f0'
                },
                { 
                    icon: 'fas fa-comma', 
                    title: '标点符号', 
                    value: stats.punctuation, 
                    unit: '个',
                    color: '#f72585'
                },
                { 
                    icon: 'fas fa-asterisk', 
                    title: '其他符号', 
                    value: stats.symbols, 
                    unit: '个',
                    color: '#ff9e00'
                },
                { 
                    icon: 'fas fa-space-awesome', 
                    title: '空格', 
                    value: stats.spaces, 
                    unit: '个',
                    color: '#38b000'
                },
                { 
                    icon: 'fas fa-arrow-down', 
                    title: '换行符', 
                    value: stats.newlines, 
                    unit: '个',
                    color: '#9d4edd'
                },
                { 
                    icon: 'fas fa-list-ol', 
                    title: '总字符数（不含空格）', 
                    value: stats.totalWithoutSpaces, 
                    unit: '个',
                    color: '#3a0ca3'
                },
                { 
                    icon: 'fas fa-list-alt', 
                    title: '总字符数（含空格）', 
                    value: stats.totalWithSpaces, 
                    unit: '个',
                    color: '#3a0ca3'
                }
            ];
            
            statsGrid.innerHTML = statsData.map(stat => `
                <div class="stat-card" style="border-left-color: ${stat.color}">
                    <i class="${stat.icon}" style="color: ${stat.color}"></i>
                    <div class="stat-title">${stat.title}</div>
                    <div class="stat-value">${formatNumber(stat.value)}</div>
                    <div class="stat-unit">${stat.unit}</div>
                </div>
            `).join('');
        }

        // 更新摘要信息
        function updateSummary(stats) {
            const summarySection = document.getElementById('summarySection');
            
            summarySection.innerHTML = `
                <div class="summary-item">
                    <div class="summary-value">${formatNumber(stats.totalWithSpaces)}</div>
                    <div class="summary-label">总字符数（含空格）</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">${formatNumber(stats.totalWithoutSpaces)}</div>
                    <div class="summary-label">总字符数（不含空格）</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">${formatNumber(stats.chineseChars + stats.foreignChars + stats.digits)}</div>
                    <div class="summary-label">文字和数字总数</div>
                </div>
            `;
        }

        // 生成所有输出文本
        function generateAllOutputs() {
            const text = document.getElementById('textInput').value;
            
            // 生成三种输出模式
            const output1 = removeSpacesOnly(text);          // 只去除空格
            const output2 = removeNewlinesOnly(text);        // 只去除换行
            const output3 = removeSpacesAndNewlines(text);   // 去除空格和换行
            
            // 保存到全局变量
            currentOutputs = {
                output1: output1,
                output2: output2,
                output3: output3
            };
            
            // 显示当前选中的输出模式
            showCurrentOutput();
        }

        // 只去除空格（保留换行）
        function removeSpacesOnly(text) {
            return text.replace(/[ \t]/g, '');
        }

        // 只去除换行（保留空格，合并为一行）
        function removeNewlinesOnly(text) {
            return text.replace(/\n/g, '');
        }

        // 去除空格和换行（合并为一行且无空格）
        function removeSpacesAndNewlines(text) {
            return text.replace(/\s/g, '');
        }

        // 显示当前选中的输出
        function showCurrentOutput() {
            const outputArea = document.getElementById('outputArea');
            const outputTitle = document.getElementById('outputTitle');
            
            // 根据当前选中的标签显示对应的输出
            switch(currentOutputTab) {
                case 1:
                    outputTitle.textContent = "输出文本（只去除空格）";
                    currentOutputText = currentOutputs.output1;
                    break;
                case 2:
                    outputTitle.textContent = "输出文本（只去除换行）";
                    currentOutputText = currentOutputs.output2;
                    break;
                case 3:
                    outputTitle.textContent = "输出文本（去除空格和换行）";
                    currentOutputText = currentOutputs.output3;
                    break;
            }
            
            outputArea.textContent = currentOutputText;
        }

        // 切换输出标签
        function switchOutputTab(tabIndex) {
            currentOutputTab = tabIndex;
            
            // 更新标签样式
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach((tab, index) => {
                if (index === tabIndex - 1) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // 显示对应的输出
            showCurrentOutput();
        }

        // 复制输出文本到剪贴板
        function copyOutput() {
            if (!currentOutputText || currentOutputText.trim() === '') {
                showNotification('请先生成输出文本！', 'warning');
                return;
            }
            
            navigator.clipboard.writeText(currentOutputText).then(() => {
                showNotification('文本已复制到剪贴板！', 'success');
            }).catch(err => {
                console.error('复制失败:', err);
                showNotification('复制失败，请手动选择文本复制', 'error');
            });
        }

        // 保存到历史记录
        function saveToHistory() {
            const text = document.getElementById('textInput').value;
            
            if (!text.trim()) {
                showNotification('请输入文本后再保存！', 'warning');
                return;
            }
            
            // 检查是否已经存在相同的记录（避免重复保存）
            const isDuplicate = history.some(item => {
                return item.text === text && 
                       item.output1 === removeSpacesOnly(text) &&
                       item.output2 === removeNewlinesOnly(text) &&
                       item.output3 === removeSpacesAndNewlines(text);
            });
            
            if (isDuplicate) {
                showNotification('相同的记录已存在！', 'info');
                return;
            }
            
            // 生成三种输出模式的文本
            const output1 = removeSpacesOnly(text);
            const output2 = removeNewlinesOnly(text);
            const output3 = removeSpacesAndNewlines(text);
            
            // 创建历史记录项
            const historyItem = {
                id: Date.now(),
                date: new Date().toLocaleString('zh-CN'),
                timestamp: Date.now(),
                text: text,
                output1: output1, // 只去除空格
                output2: output2, // 只去除换行
                output3: output3, // 去除空格和换行
                stats: {...currentStats}
            };
            
            // 添加到历史记录数组开头
            history.unshift(historyItem);
            
            // 限制历史记录数量
            if (history.length > MAX_HISTORY_ITEMS) {
                history = history.slice(0, MAX_HISTORY_ITEMS);
            }
            
            // 保存到本地存储
            saveHistoryToStorage();
            
            // 更新历史记录显示
            renderHistory();
            
            showNotification('记录已保存到历史记录！', 'success');
        }

        // 加载历史记录
        function loadHistory() {
            const storedHistory = localStorage.getItem(HISTORY_KEY);
            
            if (storedHistory) {
                try {
                    history = JSON.parse(storedHistory);
                    
                    // 按时间戳排序（最新的在前）
                    history.sort((a, b) => b.timestamp - a.timestamp);
                    
                    renderHistory();
                } catch (e) {
                    console.error('解析历史记录失败:', e);
                    history = [];
                }
            }
        }

        // 保存历史记录到本地存储
        function saveHistoryToStorage() {
            try {
                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
            } catch (e) {
                console.error('保存历史记录失败:', e);
                showNotification('保存历史记录失败，可能已超出存储限制', 'error');
            }
        }

        // 渲染历史记录
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            const historyDetails = document.getElementById('historyDetails');
            const historyCount = document.getElementById('historyCount');
            
            historyCount.textContent = history.length;
            
            if (history.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-history">
                        <i class="fas fa-history"></i>
                        <p>暂无历史记录</p>
                        <p>开始统计文本并保存记录吧！</p>
                    </div>
                `;
                
                historyDetails.innerHTML = '';
                return;
            }
            
            // 渲染历史记录列表
            historyList.innerHTML = history.map((item, index) => `
                <div class="history-item" data-id="${item.id}">
                    <div class="history-header">
                        <div class="history-date">
                            <i class="far fa-calendar-alt"></i> ${item.date}
                        </div>
                        <div>
                            <span class="highlight">#${index + 1}</span>
                        </div>
                    </div>
                    
                    <div class="history-stats">
                        <div class="history-stat">
                            <strong>总字符:</strong> ${formatNumber(item.stats.totalWithSpaces)}
                        </div>
                        <div class="history-stat">
                            <strong>中文:</strong> ${formatNumber(item.stats.chineseChars)}
                        </div>
                        <div class="history-stat">
                            <strong>外文:</strong> ${formatNumber(item.stats.foreignChars)}
                        </div>
                        <div class="history-stat">
                            <strong>数字:</strong> ${formatNumber(item.stats.digits)}
                        </div>
                    </div>
                    
                    <div class="history-actions">
                        <button class="action-btn load-btn" onclick="loadHistoryItem('${item.id}')">
                            <i class="fas fa-redo"></i> 加载
                        </button>
                        <button class="action-btn view-btn" onclick="viewHistoryItem('${item.id}')">
                            <i class="fas fa-eye"></i> 查看详情
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteHistoryItem('${item.id}')">
                            <i class="fas fa-trash"></i> 删除
                        </button>
                    </div>
                    
                    <div class="history-preview">
                        ${item.text.substring(0, 150)}${item.text.length > 150 ? '...' : ''}
                    </div>
                </div>
            `).join('');
            
            // 渲染详细历史记录
            renderHistoryDetails();
        }

        // 渲染详细历史记录
        function renderHistoryDetails() {
            const historyDetails = document.getElementById('historyDetails');
            
            historyDetails.innerHTML = history.map((item, index) => `
                <div class="history-item-details" data-id="${item.id}">
                    <h4>
                        <span><i class="far fa-calendar-alt"></i> ${item.date} - 记录 #${index + 1}</span>
                        <button class="close-details" onclick="closeHistoryDetails('${item.id}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </h4>
                    
                    <div class="history-stats">
                        <div class="history-stat">
                            <strong>总字符（含空格）:</strong> ${formatNumber(item.stats.totalWithSpaces)}
                        </div>
                        <div class="history-stat">
                            <strong>总字符（不含空格）:</strong> ${formatNumber(item.stats.totalWithoutSpaces)}
                        </div>
                        <div class="history-stat">
                            <strong>中文字符:</strong> ${formatNumber(item.stats.chineseChars)}
                        </div>
                        <div class="history-stat">
                            <strong>数字:</strong> ${formatNumber(item.stats.digits)}
                        </div>
                        <div class="history-stat">
                            <strong>外文字符:</strong> ${formatNumber(item.stats.foreignChars)}
                        </div>
                        <div class="history-stat">
                            <strong>标点符号:</strong> ${formatNumber(item.stats.punctuation)}
                        </div>
                        <div class="history-stat">
                            <strong>其他符号:</strong> ${formatNumber(item.stats.symbols)}
                        </div>
                        <div class="history-stat">
                            <strong>空格:</strong> ${formatNumber(item.stats.spaces)}
                        </div>
                        <div class="history-stat">
                            <strong>换行符:</strong> ${formatNumber(item.stats.newlines)}
                        </div>
                    </div>
                    
                    <h5><i class="fas fa-align-left"></i> 原始文本</h5>
                    <div class="history-text">${item.text}</div>
                    
                    <h5><i class="fas fa-minus"></i> 输出1：只去除空格</h5>
                    <div class="history-text">${item.output1}</div>
                    
                    <h5><i class="fas fa-compress-alt"></i> 输出2：只去除换行</h5>
                    <div class="history-text">${item.output2}</div>
                    
                    <h5><i class="fas fa-ban"></i> 输出3：去除空格和换行</h5>
                    <div class="history-text">${item.output3}</div>
                    
                    <div class="history-actions">
                        <button class="action-btn load-btn" onclick="loadHistoryItem('${item.id}')">
                            <i class="fas fa-redo"></i> 加载此记录
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteHistoryItem('${item.id}')">
                            <i class="fas fa-trash"></i> 删除此记录
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // 加载历史记录项
        function loadHistoryItem(id) {
            const item = history.find(item => item.id == id);
            
            if (item) {
                document.getElementById('textInput').value = item.text;
                
                // 保存加载的文本到localStorage
                localStorage.setItem(CURRENT_TEXT_KEY, item.text);
                
                // 更新统计
                currentStats = item.stats;
                displayStats(item.stats);
                updateSummary(item.stats);
                
                // 更新输出
                currentOutputs = {
                    output1: item.output1,
                    output2: item.output2,
                    output3: item.output3
                };
                
                showCurrentOutput();
                
                showNotification('记录已加载！', 'success');
            }
        }

        // 查看历史记录项详情
        function viewHistoryItem(id) {
            const details = document.getElementById('historyDetails');
            details.classList.remove('hidden');
            
            // 滚动到详情区域
            details.scrollIntoView({ behavior: 'smooth' });
            
            // 高亮对应的记录
            const itemElement = details.querySelector(`[data-id="${id}"]`);
            if (itemElement) {
                // 移除之前的高亮
                details.querySelectorAll('.history-item-details').forEach(el => {
                    el.style.backgroundColor = '';
                });
                
                // 高亮当前项
                itemElement.style.backgroundColor = 'rgba(67, 97, 238, 0.1)';
                itemElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // 关闭历史记录详情
        function closeHistoryDetails(id) {
            const itemElement = document.querySelector(`.history-item-details[data-id="${id}"]`);
            if (itemElement) {
                itemElement.style.display = 'none';
            }
        }

        // 切换历史记录详情显示/隐藏
        function toggleHistoryDetails() {
            const details = document.getElementById('historyDetails');
            details.classList.toggle('hidden');
        }

        // 删除历史记录项
        function deleteHistoryItem(id) {
            if (confirm('确定要删除这条记录吗？')) {
                history = history.filter(item => item.id != id);
                saveHistoryToStorage();
                renderHistory();
                showNotification('记录已删除！', 'success');
            }
        }

        // 清空历史记录
        function clearHistory() {
            if (history.length === 0) {
                showNotification('历史记录已经是空的！', 'info');
                return;
            }
            
            if (confirm(`确定要清空所有 ${history.length} 条历史记录吗？此操作不可撤销。`)) {
                history = [];
                saveHistoryToStorage();
                renderHistory();
                showNotification('历史记录已清空！', 'success');
            }
        }

        // 清空文本
        function clearText() {
            document.getElementById('textInput').value = '';
            document.getElementById('outputArea').textContent = '';
            document.getElementById('fileInfo').textContent = '';
            
            // 清除localStorage中的当前文本
            localStorage.removeItem(CURRENT_TEXT_KEY);
            
            // 重置统计
            const emptyStats = {
                chineseChars: 0, digits: 0, foreignChars: 0, punctuation: 0,
                symbols: 0, spaces: 0, newlines: 0, totalWithSpaces: 0, totalWithoutSpaces: 0
            };
            
            currentStats = emptyStats;
            displayStats(emptyStats);
            updateSummary(emptyStats);
            
            // 重置输出
            currentOutputText = "";
            
            showNotification('文本已清空！', 'success');
        }

        // 粘贴文本
        async function pasteText() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('textInput').value = text;
                countCharacters();
                showNotification('文本已粘贴！', 'success');
            } catch (err) {
                console.error('粘贴失败:', err);
                showNotification('无法访问剪贴板，请使用Ctrl+V手动粘贴', 'error');
            }
        }

        // 格式化数字（添加千位分隔符）
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            // 移除现有的通知
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => {
                notification.remove();
            });
            
            // 创建通知元素
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // 3秒后移除通知
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // 设置文件上传
        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', handleFileSelect);
        }

        // 处理文件选择
        async function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('fileInfo').innerHTML = `
                <i class="fas fa-file"></i> ${file.name} (${formatBytes(file.size)})
            `;
            
            try {
                const text = await readFile(file);
                document.getElementById('textInput').value = text;
                
                // 保存加载的文本到localStorage
                localStorage.setItem(CURRENT_TEXT_KEY, text);
                
                countCharacters();
                showNotification(`文件 "${file.name}" 已加载！`, 'success');
            } catch (error) {
                console.error('读取文件失败:', error);
                showNotification('读取文件时出错: ' + error.message, 'error');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // 读取文件内容
        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = () => reject(new Error('无法读取文件'));
                
                // 根据文件类型选择读取方式
                if (file.type.startsWith('text/') || 
                    file.name.endsWith('.txt') || 
                    file.name.endsWith('.md') ||
                    file.name.endsWith('.html') ||
                    file.name.endsWith('.js') ||
                    file.name.endsWith('.css') ||
                    file.name.endsWith('.py') ||
                    file.name.endsWith('.java') ||
                    file.name.endsWith('.cpp') ||
                    file.name.endsWith('.csv') ||
                    file.name.endsWith('.json') ||
                    file.name.endsWith('.xml')) {
                    reader.readAsText(file, 'UTF-8');
                } else {
                    alert('文件格式可能不受支持，尝试以文本格式读取');
                    reader.readAsText(file);
                }
            });
        }

        // 格式化文件大小
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 设置拖放功能
        function setupDragAndDrop() {
            const dropArea = document.getElementById('dropArea');
            
            // 防止默认拖放行为
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            // 高亮拖放区域
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            // 处理文件拖放
            dropArea.addEventListener('drop', handleDrop, false);
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight() {
            document.getElementById('dropArea').classList.add('dragover');
        }

        function unhighlight() {
            document.getElementById('dropArea').classList.remove('dragover');
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length) {
                const file = files[0];
                const event = { target: { files: [file] } };
                handleFileSelect(event);
            }
        }
    </script>
</body>
</html>
